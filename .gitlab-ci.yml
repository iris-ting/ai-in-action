stages:
  - diff
  - testgen

print_python_diff:
  stage: diff
  script:
    - echo "Getting modified Python files..."
    - python3 get_diff.py
  only:
    - merge_requests
    - branches
  image: python:3.10

generate_test_script:
  stage: testgen
  script:
    - echo "$GCP_KEY_BASE64" | base64 -d > key.json
    - export GOOGLE_APPLICATION_CREDENTIALS="$PWD/key.json"
    - echo "Installing packages"
    - pip install -r requirements.txt --quiet
    - echo "Generating test script from Vertex AI..."
    - python3 generate_test_script.py
  only:
    - merge_requests
    - branches
  image: python:3.10