stages:
  - diff
  - testgen

print_python_diff:
  stage: diff
  script:
    - echo "Getting modified Python files..."
    - python3 get_diff.py
  only:
    - merge_requests
    - branches
  image: python:3.10

generate_test_script:
  stage: testgen
  script:
    - echo "$GCP_KEY_BASE64" | base64 -d > key.json
    - export GOOGLE_APPLICATION_CREDENTIALS="$PWD/key.json"
    - echo "Installing packages"
    - pip install -r requirements.txt --quiet
    - echo "Generating test script from Vertex AI..."
    - python3 generate_test_script.py
    # - git config user.name "iris-ting"
    # - git config user.email "yunchien0820@gmail.com"
    # - git checkout -b "$CI_COMMIT_REF_NAME"
    # - git add tests/*.py
    # - git commit -m "add generated test cases"
    # - git push origin "$CI_COMMIT_REF_NAME"
  only:
    - merge_requests
    - branches
  image: python:3.10